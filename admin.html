
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://jitsi.expertcollege.com/libs/lib-jitsi-meet.min.js"></script>
    <script src="common.js"></script>
    <script>
        let lobby = null;
        let connection = null;
        
        function onConnectionSuccess() {
            lobby = connection.initJitsiConference('lobby', confOptions);
            lobby.on(JitsiMeetJS.events.conference.USER_JOINED, id => {
              var list = document.getElementById('userList');
              var option = document.createElement('option');
              option.text = 'User ' + id;
              option.value = id;
              list.add(option);
        });

        lobby.on(JitsiMeetJS.events.conference.USER_LEFT, id => {
          var list = document.getElementById('userList');
          for (i = 0; i < list.length; i++) {
            if (list.options[i].value == id) {
              list.remove(id);
            }
          }
        });

        lobby.on(JitsiMeetJS.events.conference.USER_LEFT, onUserLeft); 
            lobby.join();        
        }


        function onConnectionFailed() {
          console.error('Connection Failed!');
        }  

        function disconnect() {
          console.log('disconnect!');
          connection.removeEventListener(
              JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED,
              onConnectionSuccess);
          connection.removeEventListener(
              JitsiMeetJS.events.connection.CONNECTION_FAILED,
              onConnectionFailed);
          connection.removeEventListener(
              JitsiMeetJS.events.connection.CONNECTION_DISCONNECTED,
              disconnect);
        }

        connection = new JitsiMeetJS.JitsiConnection(null, null, connOptions);

        connection.addEventListener(
          JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED,
          onConnectionSuccess);
        connection.addEventListener(
          JitsiMeetJS.events.connection.CONNECTION_FAILED,
          onConnectionFailed);
        connection.addEventListener(
          JitsiMeetJS.events.connection.CONNECTION_DISCONNECTED,
          disconnect);

        connection.connect({ id: 'adminuser'});
  </script>
</head>
<body>
  <select id="userList" size="20" multiple />
</body>
</html>
